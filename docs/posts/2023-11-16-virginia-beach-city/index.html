<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.19">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brian Zhou">
<meta name="dcterms.date" content="2023-12-13">
<meta name="description" content="As one of many lawsuits against at-large voting systems for districts in local elections, Virginia Beach City recently adopted a new City Council district map that eliminates at-large seats. We explore the new implemented plan.">

<title>GUEST POST: Virginia Beach City – ALARM Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/alarm_256_tr.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2f888a9df4d438511fe441eb1046b373.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-a90412ab12e10e4c76bfe8821856a4ea.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-dark-4e62375daf2a4f24cf24824737fc32f2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-4e62375daf2a4f24cf24824737fc32f2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-8ZZ8YY5N8M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8ZZ8YY5N8M', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/alarm_256_tr.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ALARM Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../applications.html"> 
<span class="menu-text">Applications</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://alarm-redist.github.io/redist/"> 
<span class="menu-text">redist</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/alarm-redist"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alarm_redist"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="d3ef93d10102dfa8745727d6a9171bdd" class="alert alert-primary hidden"><i class="bi bi-exclamation-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>New working paper!</strong> - <a href="https://arxiv.org/pdf/2508.15885">Gerrymandering and geographic polarization have reduced electoral competition</a></p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GUEST POST: Virginia Beach City</h1>
</div>

<div>
  <div class="description">
    <p>As one of many lawsuits against at-large voting systems for districts in local elections, Virginia Beach City recently adopted a new City Council district map that eliminates at-large seats. We explore the new implemented plan.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brian Zhou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DISCLAIMER
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post is part of our ALARM Summer Research program, where social scientists in training study redistricting analysis to learn skills in computational social science. The results do not necessarily reflect findings of the broader ALARM team, and are not intended to be used as evidence or recommendations.</p>
</div>
</div>
<center>
Jump to <a href="#analysis">analysis</a> and <a href="#takeaways">key takeaways</a>
</center>
<section id="the-virginia-beach-city-council" class="level2">
<h2 class="anchored" data-anchor-id="the-virginia-beach-city-council">The Virginia Beach City Council</h2>
<p>Virginia Beach became an incorporated town in 1906 from Princess Anne County, and became an independent city in 1952. A legal battle with the City of Norfolk prompted a consolidation of the City of Virginia Beach with Princess Anne County again in 1962, forming the independent city of Virginia Beach.</p>
<p>Virginia Beach is heavily influenced by the presence of the military. Apart from the Pentagon in Arlington, Virginia, Virginia Beach has the largest concentration of military personnel with <a href="https://www.yesvirginiabeach.com/business-environment/military">9 military installations</a> from every branch of the US armed forces; this includes the largest naval base in the world. Thus, it has been classified by the <a href="https://www.americancommunities.org/">American Communities Project</a> as a military post: “middle-income, diverse communities, around military bases.”</p>
<p>There are 11 members in the Virginia Beach City Council. Ten members of the city council are elected in one of ten districts as shown in Figure 1, including the current partisan affiliation of the council member. Displayed in Figure 2, three districts are currently Majority Minority Districts (MMDs), where the majority voting-eligible people in the district belong to a cohesive minority group.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALccdemrep.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 1: <em>Current Partisan Breakdown of City Council Members</em></figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALccmmd.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 2: <em>Majority Minority Districts in Virginia Beach City</em></figcaption>
</figure>
</div>
</div>
</div>
<p>The eleventh member is elected at-large to serve as the mayor of the city. While the council is legally nonpartisan, candidates with political affiliations emerged just seven years after the formation of the city council in 1963. Historical elections have been competitive between both Democrats and Republicans with a few declared independents, but the overall majority of the city council historically leaned Republican, especially prior to the 2022 court-ordered redistricting. The current 2023 City Council is comprised of six Democrats and five Republicans (Figure 1), with Republican Bobby Dyer serving as mayor. No candidates were up for reelection in the November 7, 2023 Virginia general election.</p>
<table class="caption-top table">
<caption>Table 1: Current Virginia Beach City Council makeup. Majority-Minority Districts are italicized.</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th><span class="smallcaps">Mayor</span></th>
<th><span class="smallcaps">1</span></th>
<th><span class="smallcaps">2</span></th>
<th><span class="smallcaps">3</span></th>
<th><span class="smallcaps"><em>4</em></span></th>
<th><span class="smallcaps">5</span></th>
<th><span class="smallcaps">6</span></th>
<th><span class="smallcaps"><em>7</em></span></th>
<th><span class="smallcaps">8</span></th>
<th>9</th>
<th><em>10</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bobby Dyer (R)</td>
<td>Rocky Holcomb (R)</td>
<td>Barbara M. Henley (D)</td>
<td>Michael Berlucchi (R)</td>
<td><em>Amelia Ross-Hammond (D)</em></td>
<td>Rosemary Wilson (R)</td>
<td>Worth Remick (D)</td>
<td><em>Sabrina Wooten (D)</em></td>
<td>Chris Taylor (R)</td>
<td>Joash Schulman (D)</td>
<td><em>Jennifer Rouse (D)</em></td>
</tr>
</tbody>
</table>
<p>The ten districts are constructed from 108 voting precincts displayed in Figure 3 below. Census blocks, which are areas bounded by visible features such as roads or streams and invisible features such as property lines or other city/school districts, are visualized in Figure 4. These blocks help visualize where the city is located, as census blocks often follow city blocks in urban environments.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALccprecinct.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 3: <em>Map of Voting Precincts and City Council Boundaries in Virginia Beach City</em></figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALccblocks.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 4: <em>Map of Census Blocks and City Council Boundaries in Virginia Beach City</em></figcaption>
</figure>
</div>
</div>
</div>
<section id="demographics-partisan-breakdown" class="level3">
<h3 class="anchored" data-anchor-id="demographics-partisan-breakdown">Demographics &amp; Partisan Breakdown</h3>
<p>Virginia Beach City has a population of 457,672 recorded in the 2020 US census, making it the largest independent city in Virginia and the 42nd largest in the United States. It is ranked by the Census Bureau as the 36th largest urban area; its metropolitan statistical area (MSA), the Hampton Roads MSA, is the 37th largest metropolitan area in the US. The overall demographic breakdown of the city is in the table below; population data is sourced from the 2020 Census and VAP/CVAP data is sourced from a count by the Virginia Department of Elections in the 2019 Virginia elections.</p>
<table class="caption-top table">
<caption>Table 2: Demographic Breakdown of Virginia Beach, VA. in 2020</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Demographic</th>
<th>Population</th>
<th>Voting Age Pop.</th>
<th>Citizen Voting Age Pop.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>White, non-Hispanic</td>
<td>58.7%</td>
<td>61.5%</td>
<td>65.8%</td>
</tr>
<tr class="even">
<td>Black, non-Hispanic</td>
<td>20.1%</td>
<td>20.1%</td>
<td>19.7%</td>
</tr>
<tr class="odd">
<td>Asian, non-Hispanic</td>
<td>10%</td>
<td>9.4%</td>
<td>6.8%</td>
</tr>
<tr class="even">
<td>Hispanic</td>
<td>8.8%</td>
<td>7.6%</td>
<td>6.4%</td>
</tr>
<tr class="odd">
<td>Black + Hispanic + Asian</td>
<td>40.5%</td>
<td>37.2%</td>
<td>32.8%</td>
</tr>
</tbody>
</table>
<p>Figure 5 shows the population density of the overall city to a precinct level. This is important for drawing city council boundaries, as per the Virginia Voting Rights Act, a district can only deviate from the average population in every district by 5%. However, how do we know who is actually eligible to vote? Figure 6 shows the percentage of the population in any given precinct that is of voting age, which is more indicative of current voter demographics.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALpopulation.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 5: <em>Population Density by Precinct</em></figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALvap.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 6: <em>Percent Voting Age Population by Precinct</em></figcaption>
</figure>
</div>
</div>
</div>
<p>Figures 7 and 8 show the percentage of minority and black populations by precinct. Districts 4, 7, and 10 are majority-minority districts (MMDs), shown in Figure 2.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALminoritypop.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 7: <em>Minority Population Percentage by Precinct</em></figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALblackpop.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 8: <em>Black Population Percentage by Precinct</em></figcaption>
</figure>
</div>
</div>
</div>
<p>In Virginia Beach City, minority populations tend to vote as a block for Democratic candidates. Figure 9 displays the vote percentage of Democrats and Republicans in each precinct; Democrats perform best in black/minority precincts. To quantify how cohesive a group of voters are, Figure 10 examines only precincts where the majority of residents in the precinct is a minority. The percentage of democratic votes in any given precinct trends similarly to the overall percentage of minority residents in the precinct, ranging from a .78 to 1.05 ratio.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALpartisan.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 9: <em>Percent of Democratic Votes by Precinct.</em> Color and percent indicate partisan tilt.</figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALDemmmps.svg" class="img-fluid figure-img" width="720"></p>
<figcaption>Figure 10: <em>Percent of Democratic Votes Compared to Minority Percentages in MMPs</em></figcaption>
</figure>
</div>
</div>
</div>
<p>Notably, voters have different voting preferences compared to trends in federal elections. Although Figure 1 and Table 1 both show that there are 6 current Democratic council members, based on general voting trends, elections tend to tilt the following ways shown in Figure 11:</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALpartisandistrict.svg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Figure 11: <em>Percent of Democratic Votes by District</em></figcaption>
</figure>
</div>
</center>
</section>
</section>
<section id="redistricting-in-virginia-beach" class="level2">
<h2 class="anchored" data-anchor-id="redistricting-in-virginia-beach">Redistricting in Virginia Beach</h2>
<section id="holloway-v.-city-of-virginia-beach-va." class="level3">
<h3 class="anchored" data-anchor-id="holloway-v.-city-of-virginia-beach-va.">Holloway v. City of Virginia Beach, Va.</h3>
<p>In 2017, Virginia Beach residents Latasha Holloway and Georgia Allen sued the City of Virginia Beach claiming that Virginia Beach’s current at-large method to elect council members violated Section 2 of the Voting Rights Act by diluting the strength of minority votes in the legal case <a href="https://thearp.org/litigation/holloway-v-city-virginia-beach-va/">Holloway v. City of Virginia Beach, Va.</a> Since 1998, Virginia Beach City Council members were elected in seven districts including three at-large council members; although candidates for one of the seven district seats had to reside in the district they were running for, all voting was conducted at-large. Residents of any district could vote in all seven district elections and the three at-large candidates.</p>
<p>In 2021, Virginia passed <a href="https://lis.virginia.gov/cgi-bin/legp604.exe?ses=212&amp;typ=bil&amp;val=HB2198">HB 2198</a>, which prohibits local governments from using at-large voting for district elections. This led to the 2021 ruling in which the district court ruled that the at-large election method did violate Section 2 of the Voting Rights Act by denying large minority groups in Virginia Beach (African-Americans, Hispanics, and Asians) equal access to political participation, and that those groups were politically cohesive. Although the City of Virginia Beach appealed the decision, the court proceeded by appointing a special master to create a remedial redistricting plan, established in <a href="https://www.wavy.com/wp-content/uploads/sites/3/2021/12/e18b14d0-d4e8-4b5c-9805-ccc031edf776.pdf">this memo</a>. This plan was adopted in 2022 before the November election after another round of appeals in the Fourth Circuit. The Virginia Beach School Board, which historically followed the same election system as the city council, <a href="https://www.wavy.com/news/local-news/virginia-beach/vb-school-board-votes-to-mirror-new-city-council-election-system-possibly-pitting-incumbents-against-each-other/">voted in 2022</a> to adopt the same election system as the city council.</p>
<p>In 2022, the Fourth Circuit Appeals Court ruled in a 2-1 decision that the case should not have been considered by the district court, holding that HB 2198 already made the electoral system challenged by the plaintiffs illegal. This meant that the at-large electoral system no longer governed Virginia Beach City already and rendered the court case moot. The timing of the ruling meant that the redrawn maps and electoral system would be used in 2022, and could be modified if it met the requirements of the Virginia Voting Rights Act and HB 2198, both of which prevent at-large voting systems if they prevent minority groups from electing preferred candidates.</p>
<p>The makeup of the city council drastically shifted in the 2022 general election, the first local election under the 10-1 system. The council is the <a href="https://www.pilotonline.com/2023/01/04/virginia-beach-city-council-now-the-most-diverse-in-city-history-welcomes-new-members/">most diverse</a> and youngest in city history, with four Black representatives and four members under 45. <a href="https://wydaily.com/news/local/2019/01/04/new-city-council-could-be-the-most-diverse-in-virginia-beach-history/">In all of the city council’s history</a> since 1966, only four prior city council members were Black, and at most had two seats on the city council at any point in time. Democrats gained two seats on the city council, shifting the makeup from 6 GOP and 4 DEM with a GOP mayor in 2022 to 6 DEM and 4 GOP in 2023.</p>
<p>After a <a href="https://www.13newsnow.com/article/news/local/vote/virginia-beach-last-public-hearing-on-switch-10-1-voting-system-ahead-of-city-council-vote/291-e23afe35-c0f9-4555-812b-8980bf89dfa0">round of public hearings</a> over the new election system and a survey that showed <a href="https://www.pilotonline.com/2023/07/02/virginia-beach-residents-want-to-keep-district-election-system-according-to-study/">81% of residents supported the new system</a>, the city council voted to <a href="https://campaignlegal.org/update/victory-virginia-beach-adopts-fair-districts-after-clc-successfully-sued-city">adopt the 10-1 election system</a> with the court-sanctioned district map on August 15th, 2023. Per Virginia state law, any new electoral system, such as 7 districts and 4 at-large, would require approval from the Virginia General Assembly to revise the charter, which at earliest could happen when the General Assembly reconvenes in January 2024.</p>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="do-the-new-maps-gerrymander-minority-populations" class="level3">
<h3 class="anchored" data-anchor-id="do-the-new-maps-gerrymander-minority-populations">Do the New Maps Gerrymander Minority Populations?</h3>
<p>As the new maps include 3 majority-minority districts compared to a minority CVAP of 32.8%, we find that the new implemented maps do not gerrymander minority populations and are compliant with both the Virginia Voting Rights Act and the Federal Voting Rights Act. Based on demographic shifts in younger voters (who have a higher minority population), a future map may necessitate the creation of a fourth majority-minority district.</p>
<p>The Virginia Voting Rights Act mandates that at-large local elections are banned if they dilute the voting power of minority populations. Instead, based on the percentage of the on the percentage of minorities in the citizen Voting Age Population and how cohesive minority voters are, minority opportunity districts would be created to protect minority voting power. Virginia Beach City has a cohesive democratic-leaning minority population that accounts for 32.8% of the citizen Voting Age Population. As there are 10 city council seats, three seats must be in MMDs.</p>
<p>The minority voting age population plot is displayed below. The graph orders each district from smaller to larger share of minority voting age population in each district. Each point represents one instance of a simulation, with the color of the point indicating if the district is projected to lean Democratic or Republican. The grey bars show the current ratified plan, showing that the current plan exceeds in creating three VAP districts. Notably, the enacted plan intentionally creates three solid majority-minority districts, demonstrated by the gap between the 7th and 8th districts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALminperfplot.png" class="img-fluid figure-img"></p>
<figcaption>Figure 12: <em>Simulated Majority Minority District Counts</em></figcaption>
</figure>
</div>
<p>We study the number of districts that are MMDs in any of the 200,000 plans. Total counts for performing MMDs in each simulation is displayed below, where a performing district has a minority VAP above 50% and an expected democratic vote share above 50%. This second criteria is less important, as every simulated district with an above 50% minority VAP is democratic.</p>
<table class="caption-top table">
<caption>Table 3: Majority-Minority District appearance rate in 200,000 simulations</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Count of plans</th>
<th>0 districts</th>
<th>1 district</th>
<th>2 districts</th>
<th>3 districts</th>
<th>4 districts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Plans with <em>n</em> districts exactly</td>
<td>3879</td>
<td>54257</td>
<td>116584</td>
<td>24880</td>
<td>400</td>
</tr>
<tr class="even">
<td>Plans with at least <em>n</em> districts</td>
<td>200000</td>
<td>196121</td>
<td>141864</td>
<td>25280</td>
<td>400</td>
</tr>
<tr class="odd">
<td>% plans with at least <em>n</em> districts</td>
<td>100%</td>
<td>98.06%</td>
<td>70.93%</td>
<td>12.64%</td>
<td>2%</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<caption>Table 4: Majority-Black District appearance rate in 200,000 simulations</caption>
<colgroup>
<col style="width: 64%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Count of plans</th>
<th>0 districts</th>
<th>1 districts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exactly <em>n</em> districts</td>
<td>55007</td>
<td>144993</td>
</tr>
<tr class="even">
<td>% of simulations with at least <em>n</em> districts</td>
<td>100%</td>
<td>72.50%</td>
</tr>
</tbody>
</table>
<p>As simulations usually only create two MMDs (~116k simulations) or more (~71% occurence), it is clear that the enacted plan intentionally upholds the need for three MMDs based on the Virginia Voting Rights Act.</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALpercentmmd.svg" class="img-fluid figure-img" style="width:45.0%"></p>
<figcaption>Figure 13: <em>Percent of All Simulations Where the Precinct is in a Simualted MMD.</em></figcaption>
</figure>
</div>
</center>
</section>
<section id="do-the-new-maps-have-partisan-gerrymandering" class="level3">
<h3 class="anchored" data-anchor-id="do-the-new-maps-have-partisan-gerrymandering">Do the New Maps Have Partisan Gerrymandering?</h3>
<p>Although there is evidence that two Democratic districts are being packed, Virginia Beach voters often vote split-ticket on the local level, having elected two Democratic council members in Republican-leaning seats.</p>
<p>Shown in Figure 14, many of the real districts appear to be packed compared to what the simulated districts would indicate.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demrepsplit.png" class="img-fluid figure-img"></p>
<figcaption>Figure 14: <em>Democratic vote share by district in simulated runs. Black squares indicate the actual democratic vote share in the enacted plan, ordered by lowest to highest.</em></figcaption>
</figure>
</div>
<p>We can get a better understanding with a box plot. The real Districts 9 and 10 appear to pack democratic voters compared to the simulated distribution of districts, while Districts 5 and 6 appear to be intentionally drawn to make the districts, whose median would be a toss-up and Democratic-leaning respectively, Republican.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALexpecteddem.png" class="img-fluid figure-img"></p>
<figcaption>Figure 15: <em>Boxplot of democratic vote share by district in simulated runs.</em></figcaption>
</figure>
</div>
<p>One effective method of determining partisan gerrymandering is by measuring the efficiency gap of any given map, which is a value from -100% to 100% where negative implies pro-Democratic bias and positive implies pro-Republican bias. The current plan has an efficiency gap of 18.3% in favor of Republicans. Generally, an efficiency gap above 7% in favor of either party is regarded as partisan gerrymandering. This gives us evidence of partisan gerrymandering that favors Republicans in Virginia Beach City. We calculate the efficiency gap as the difference between votes from the party that loses a district and excess votes above 50% that weren’t necessary to win a district, divided by total votes.</p>
</section>
<section id="are-the-new-maps-competitive" class="level3">
<h3 class="anchored" data-anchor-id="are-the-new-maps-competitive">Are the New Maps Competitive?</h3>
<p>While five of the districts are competitive, the other five are extremely noncompetitive. In Figure 16, we look at the difference between the vote percentages of the winning and losing party in any given district. Defining a 10% difference as competitive, we can see that while four of the actual districts are competitive, the simulated plans could support all the way to eight competitive districts. At a minimum, two additional districts could easily be made competitive.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALcompetitiveness.png" class="img-fluid figure-img"></p>
<figcaption>Figure 16: <em>Democratic vote share by district in simulated runs. Black squares indicate the actual democratic vote share in the enacted plan, ordered by lowest to highest.</em></figcaption>
</figure>
</div>
<p>Instead of defining an arbitrary 10% difference, we can look at how competitive the actual districts are compared to the ensemble of simulated districts. Figure 17 shows that there are five competitive districts, and five extremely uncompetitive districts, four of which are outliers that indicate the plan was intentionally drawn to be uncompetitive. Any district that has good competitiveness would be any real district below the 25th percentile (a very small difference in vote count), indicating that it is more competitive than most simulated districts, and vice versa. Districts above the 75th percentile would have poor competitiveness.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALcompboxplot.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 17: <em>Boxplot of the absolute difference in vote counts.</em></figcaption>
</figure>
</div>
<p>While this shows that the city council districts of Virginia Beach City could be made more competitive, it is likely that three of the five districts that are less competitive merely stem from creating three MMDs which lean Democratic in every simulation.</p>
</section>
</section>
<section id="methods-and-materials" class="level2">
<h2 class="anchored" data-anchor-id="methods-and-materials">Methods and Materials</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>We gathered election data from the 2022 U.S. House election that took place in Virginia Beach City. Although the house district encompasses other parts of the Hampton Roads metropolitan area, the Virginia election results website includes breakdowns for all the precincts in Virginia Beach City. The U.S. House was selected, as only the 1st, 2nd, 4th, 6th, 8th, 9th, and 10th city council districts elected a member under the new system in 2022. This makes a full analysis of the city council election unfeasible, as prior elections for city council still operated under the at-large voting system.</p>
<p>Because the Virginia Department of Elections differentiates between early vote (by mail and in-person) and election day vote results for each precinct, data was sourced from two places in the Virginia election results website:</p>
<ul>
<li><p><a href="https://results.elections.virginia.gov/vaelections/2022%20November%20General/Site/Locality/VIRGINIA_BEACH_CITY/Member_House_of_Representatives_(02).html">2022 November General Election Virginia Beach City House of Representatives Votes by Precinct</a></p></li>
<li><p><a href="https://results.elections.virginia.gov/vaelections/2022%20November%20General/Site/Absentee/VIRGINIA_BEACH_CITY/Index.html">2022 November General Election Virginia Beach City House of Representatives Absentee Voting by Precinct</a></p></li>
</ul>
<p>We compile the specific data (Election Day, Early Voting, Mailed Absentee, Provisional, and Post-Election) to create overall vote splits by precinct. 249 write-in ballots, which constituted 0.15% of the total vote in Virginia Beach, are discarded.</p>
</section>
<section id="runs-and-simulations" class="level3">
<h3 class="anchored" data-anchor-id="runs-and-simulations">Runs and Simulations</h3>
<p>We sample 20,000 districting plans for Virginia Beach City across ten independent runs of the <a href="https://alarm-redist.org/redist/reference/redist_smc.html">Sequential Monte Carlo algorithm</a> according to <a href="#redistricting-requirements">the relevant criteria</a>. A <a href="#summary-of-simulations">summary of simulations</a> can be found below.</p>
</section>
<section id="redistricting-requirements" class="level3">
<h3 class="anchored" data-anchor-id="redistricting-requirements">Redistricting Requirements</h3>
<p>Per <a href="redistrictingguidelines.pdf">Virginia and Federal law</a> under <a href="https://casetext.com/statute/code-of-virginia/title-242-elections/chapter-3-election-districts-precincts-and-polling-places/article-2-congressional-senatorial-and-house-of-delegates-districts/section-242-30404-standards-and-criteria-for-congressional-and-state-legislative-districts">Va. Code Ann. § 24.2-304.04</a> redistricting in Virginia Beach must:</p>
<ol type="1">
<li><p>have equal populations</p></li>
<li><p>provide opportunities for racial/ethnic representation</p></li>
<li><p>preserve communities of interest (Va. Code Ann. § 24.2-304.04(5).)</p></li>
<li><p>be contiguous (Va. Code Ann. § 24.2-304.04(6).)</p></li>
<li><p>be compact (Va. Code Ann. § 24.2-304.04(7).)</p></li>
</ol>
<p>In the <a href="redistrictingguidelines.pdf">2021 Virginia Redistricting</a>, the following requirements were considered in order of priority:</p>
<ol type="1">
<li><p>be contiguous, compact, and equal in population</p></li>
<li><p>preserve existing political subdivisions</p></li>
<li><p>create clearly discernible boundaries</p></li>
<li><p>be reasonably compact</p></li>
<li><p>maintain neighborhoods who share similar social, cultural, and economic interests</p></li>
</ol>
</section>
<section id="constraints" class="level3">
<h3 class="anchored" data-anchor-id="constraints">Constraints</h3>
<p>Three <a href="https://alarm-redist.org/redist/reference/constraints.html">constraints</a> are added to simulations to promote districts that will either have a cohesive black voting age population above 55% <em>or</em> a small black voting age population. This keeps historically black communities together by discouraging districts that have a percentage of black voting-age population between 20-40%.</p>
<ol type="1">
<li><p>A constraint is created that strongly promotes a plan where one district has a black voting age population of at least 55%.</p></li>
<li><p>A constraint is created that discourages where the proportion of the black voting age population is less than 40%.</p></li>
<li><p>A constraint is created that encourages districts where the black voting age population is less than 20%.</p></li>
</ol>
</section>
<section id="neighborhoods" class="level3">
<h3 class="anchored" data-anchor-id="neighborhoods">Neighborhoods</h3>
<p>We utilize elementary school attendance zones to preserve similar communities of interest. School zoning is effective as neighborhoods are often shaped by the school district; school districts often create cohesion in other neighborhood-adjacent indicators such as community and economics, as it affects home prices and who chooses to reside in any given neighborhood. We utilize the <a href="https://data.virginiabeach.gov/datasets/e185bc16ab9a4bbbaf2c2cfcf9156e78_25/about">55 elementary school attendance zones</a> to serve as a de-facto neighborhood map. School attendance zones usually correlate with historic areas of a city/county, and elementary school attendance zones are small enough to be beneficial for redistricting simulations while encompassing 2-3 neighborhoods.</p>
<div style="display: flex;">
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALespre.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 18: <em>Map of Voting Precincts and City Council Boundaries in Virginia Beach City</em></figcaption>
</figure>
</div>
</div>
<div style="flex-basis: 50%; flex-direction: column;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FINALes.svg" class="img-fluid figure-img"></p>
<figcaption>Figure 19: <em>Map of Voting Precincts and Elementary School Boundaries in Virginia Beach City</em></figcaption>
</figure>
</div>
</div>
</div>
<p>These zones are necessary as neighborhoods are important for redistricting simulations; neighborhoods help make contiguous districts that account for community boundaries to avoid splitting a community between different districts. However, neighborhoods are difficult to find in Virginia Beach City, partially because the city fully incorporates Princess Anne County. Unlike other cities such as Phoenix, AZ, the city does not maintain any officially designated neighborhood or borough subdivision of the city. Various real estate agents maintain neighborhood designations, but they all have certain downsides:</p>
<ul>
<li><p><a href="https://www.ziemerrealestate.com/virginia-beach-family-neighborhoods/">Ziemer Real Estate</a>’s neighborhoods are too large for use in preserving boundaries and have spots without neighborhoods</p></li>
<li><p><a href="https://www.williamlayton.com/best-neighborhoods-in-virginia-beach/">Layton Realty Group</a>’s neighborhoods are small and based on historic boundaries, but only cover the original area of Virginia Beach City</p></li>
<li><p><a href="https://www.city-data.com/nbmaps/neigh-Virginia-Beach-Virginia.html">City-Data</a> only has four tiny recorded neighborhoods for Virginia Beach City</p></li>
</ul>
<p>We explore various other alternatives:</p>
<ul>
<li><p><a href="https://www.unitedstateszipcodes.org/">Zip codes</a> were considered, but as there are only 20 zip codes in Virginia Beach City with odd shapes, using zip codes worsened the diversity (number of different simulated plans) in simulation outcomes</p></li>
<li><p><a href="https://www.census.gov/geographies/reference-maps/2020/geo/2020-census-block-maps.html">Census block maps</a> were also considered, but are intentionally arbitrary to maintain similarly sized blocks across the United States and split neighborhoods</p></li>
</ul>
<p>Ultimately, elementary school zoning serves as the most detailed indicator compared to sparse neighborhood data.</p>
</section>
</section>
<section id="summary-of-simulations" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-simulations">Summary of Simulations</h2>
<p><img src="FINALvalidation.png" class="img-fluid"></p>
<p>From the validation plot of our simulations, we see that our simulation ranges around the same level of compactness as the enacted plan. Simulated plans are diverse, but push against the generally acceptable boundary of a maximum 5% population deviation between districts and vary greatly in neighborhood splits. One observation is that the enacted plan packs minority voters into three districts, which was motivated by a substantially lower citizen minority voter population across Virginia Beach City. In effect, minorities in the three districts lie around a 51-53% citizen VAP majority.</p>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<p>Virginia Beach City’s new implemented plan fulfills the required 3 MMDs set by the Virginia Voting Rights Act and the Federal Voting Rights Act based on it’s current Citizen Voting Age Population of 32.8%. Immediately the results are evident: the city council elected in the wake of the new map four black representatives, equivalent to the total number of black representatives since the council was formed in 1966 prior to the 2022 election.</p>
<p>Voters also demonstrated willingness to look past party lines at the local level, voting in two Democratic city council members in districts that safely voted for the Republican representative in the same year.</p>
<p>Although there is concern for partisan gerrymandering with a efficiency gap of 18.3% in favor of Republicans, it is possible that this is a side effect of creating all three MMDs; not a single MMD ever voted Republican in any of the 200,000 simulated plans, resulting in wasted Democratic votes that contributed to the high efficiency gap. Notably, voters often voted across party lines to deliver a 6-4 Democratic majority as opposed to the projected 6-4 Republican majority.</p>
<p>Initial simulations also indicate that five districts are less competitive than comparable simulations. Currently, four of the districts have a gap of less than 10% in vote difference, but simulations reveal that future plans could create upwards of 8 competitive districts.</p>
<p>As more data using the new electoral system comes in the future, revisiting Virginia Beach City can help shed insights on how city voters adapted after its prior at-large voting system was struck down. Future work exploring further alternatives to elementary school zoning boundaries, particularly other neighborhood alternatives which may have more splits, would be helpful to more accurately simulate community interests.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/alarm-redist\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© Copyright 2021 the <a href="about.html">ALARM Project</a>. <br>Software licensed under the <a href="https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html">GNU Public License, v2.0</a>.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>